- unless @localhits.blank? || @choices.blank?
  .magellan_container{:"data-magellan-expedition" => "", :"data-options"  => "threshold:80;destination_threshold:80;throttle_delay:50;fixed_top:40;"}
    %dl.sub-nav
      %dd.active{:"data-magellan-arrival" => "localhits"}= link_to "Existing PBT entries (#{@localhits.size})", "#localhits"
      %dd{:"data-magellan-arrival" => "choices"}= link_to "Other search results (#{@choices.size})", "#choices"

        
.container.chooser
  .row
    .small-8.columns.small-2-offset
      %h2
        = "Searching for "
        %em= params[:query]
  - unless @localhits.blank?
    %a{:name => "#localhits"}
    .row{:"data-magellan-destination" => "localhits"}
      .small-12.columns
        %h3 Results already in PBT database:
        - @localhits.in_groups_of(3).each do |group|
          .choice_title.row
            - group.each_with_index do |hit, i|
              .small-4.columns{class: i == 2 ? :end : false }
                - next if hit.nil?
                .row
                  .small-3.columns
                    - if hit.filename?
                      = link_to image_tag(hit.filename.url(:small))
                  .small-9.columns
                    = link_to raw(hit.name), select_genericmaster_path(:agent_id => current_agent.id, :id => "local_#{hit.id}", :category => @category)
                    .metadata
                      = "Agents: #{hit.items.map{|x| x.agent.surname }.uniq.join(', ')}"
                

    
  - unless @choices.blank?
    %a{:name => "#choices"}
    .row{:"data-magellan-destination" => "choices"}
      .small-12.columns
        %h3 Search results:
        - if @category == "Movie" || @category == "Tvseries"
          - @choices.each do |choice|
            .choice
              .choice_title= link_to raw(choice.title.gsub(/\((\d+)$/, '(\1)')), select_genericmaster_path(:agent_id => current_agent.id, :id => choice.id, :category => @category)
        - elsif @category == "Book" || @category == "Music"
          - @choices.in_groups_of(4).each do |group|
            .row.choice_row
              - group.each_with_index do |choice, i|
                .small-3.columns{class: i == 3 ? :end : false }
                  - next if choice.nil?
                  .row
                    .small-3.columns
                      - if choice['image']
                        = link_to image_tag(choice['image']), select_genericmaster_path(:agent_id => current_agent.id, :id => choice['key'], :category => @category)
                    .small-9.columns
                      .choice_title= link_to raw(choice['title'].gsub(/\((\d+)$/, '(\1)')), select_genericmaster_path(:agent_id => current_agent.id, :id => choice['key'], :category => @category)
                      - unless choice['label'].blank? 
                        .metadata= choice['label'].join(" / ")
                      - unless choice['format'].blank?
                        .metadata= choice['format'].join(' ')
                      
          